<template><h1 id="spring-boot-多样化构建-docker-镜像" tabindex="-1"><a class="header-anchor" href="#spring-boot-多样化构建-docker-镜像" aria-hidden="true">#</a> Spring Boot 多样化构建 Docker 镜像</h1>
<p>伴随着技术的不断更新，基于 Spring Boot 构建 Docker 镜像的方式也是五花八门，大致分为以下几种：</p>
<p>Idea 构建</p>
<p>Cloud Native Buildpacks（Spring Boot 2.3+ 版本开始支持）<br />Google 的 jib-maven-plugin<br />fabric8 和 spotify 的 docker-maven-plugin</p>
<h1 id="简单的spring-boot-docker-项目" tabindex="-1"><a class="header-anchor" href="#简单的spring-boot-docker-项目" aria-hidden="true">#</a> 简单的Spring-Boot-Docker 项目</h1>
<p>先准备一个简单的基于 Maven 的 Spring Boot 项目，方便实践。</p>
<h2 id="pom" tabindex="-1"><a class="header-anchor" href="#pom" aria-hidden="true">#</a> pom</h2>
<p>添加 spring-boot-starter-web 依赖。</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>&lt;dependencies>
    &lt;dependency>
        &lt;groupId>org.springframework.boot&lt;/groupId>
        &lt;artifactId>spring-boot-starter-web&lt;/artifactId>
    &lt;/dependency>
&lt;/dependencies>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2>
<p>配置文件无需添加任何内容，基于约定优于配置，使用默认配置即可。</p>
<h2 id="启动类" tabindex="-1"><a class="header-anchor" href="#启动类" aria-hidden="true">#</a> 启动类</h2>
<div class="language-java ext-java line-numbers-mode"><pre v-pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootDockerApplication</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringBootDockerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="控制层" tabindex="-1"><a class="header-anchor" href="#控制层" aria-hidden="true">#</a> 控制层</h2>
<div class="language-java ext-java line-numbers-mode"><pre v-pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DockerController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">"Hello Spring Boot Docker!"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="启动访问" tabindex="-1"><a class="header-anchor" href="#启动访问" aria-hidden="true">#</a> 启动访问</h2>
<p>启动项目，浏览器访问：<a href="http://localhost:8080/%EF%BC%8C%E9%A1%B5%E9%9D%A2%E8%BF%94%E5%9B%9E%EF%BC%9AHello" target="_blank" rel="noopener noreferrer">http://localhost:8080/，页面返回：Hello<ExternalLinkIcon/></a> Spring Boot Docker!，说明项目OK，准备工作已完成。</p>
<h1 id="idea-本地推送到指定的docker" tabindex="-1"><a class="header-anchor" href="#idea-本地推送到指定的docker" aria-hidden="true">#</a> Idea 本地推送到指定的docker</h1>
<h2 id="dockerfile" tabindex="-1"><a class="header-anchor" href="#dockerfile" aria-hidden="true">#</a> Dockerfile</h2>
<div class="language-Docker ext-Docker line-numbers-mode"><pre v-pre class="language-Docker"><code>FROM openjdk:8u212-jre
ADD target/spring-logging-0.0.1.jar app.jar
#VOLUME /logs
EXPOSE 8080
ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="idae-配置" tabindex="-1"><a class="header-anchor" href="#idae-配置" aria-hidden="true">#</a> idae 配置</h2>
<ol>
<li>
<p>如下图红框所示，创建一个配置：</p>
</li>
<li>
<p>创建一个Dockerfile配置，如下所示：</p>
</li>
<li>
<p>Dockerfile配置详情如下图所示，请按照图中的说明进行设置，确保每个红框中都会执行到：</p>
</li>
<li>
<p>上图中最下面的那个&quot;Run Maven Goal&quot;点击后，会弹出一个小窗口 ，用来输入要执行的maven命令，这里输入</p>
</li>
</ol>
<p><strong>clean package -U -DskipTests</strong> ，表示每次在构建镜像之前，都会将当前工程清理掉并且重新编译构建：</p>
<ol>
<li>
<p>设置完成后，点击下图红框中的绿色三角按钮，执行此配置：</p>
</li>
<li>
<p>运行结果如下所示，项目构建成功后，在Docker上部署镜像成功，然后运行容器成功：</p>
</li>
</ol>
<h1 id="springboot-原生自带的配置" tabindex="-1"><a class="header-anchor" href="#springboot-原生自带的配置" aria-hidden="true">#</a> SpringBoot 原生自带的配置</h1>
<p>使用Spring Boot 2.3.X + 自带的Docker工具进行构建Docker</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mvn spring-boot:build-images
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="pom文件" tabindex="-1"><a class="header-anchor" href="#pom文件" aria-hidden="true">#</a> pom文件</h2>
<p>完整配置如下：</p>
<h3 id="私有容器配置" tabindex="-1"><a class="header-anchor" href="#私有容器配置" aria-hidden="true">#</a> 私有容器配置</h3>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- spring-boot-maven-plugin --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- fabric8 的 docker-maven-plugin --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.fabric8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>docker-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.34.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!-- 全局配置 --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 配置远程 Docker 守护进程 url --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerHost</span><span class="token punctuation">></span></span>http://192.168.10.10:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerHost</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 镜像相关配置，支持多镜像 --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>images</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 单个镜像配置 --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>
                        <span class="token comment">&lt;!-- 镜像名:版本号 --></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>${project.artifactId}:${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
                        <span class="token comment">&lt;!--
                            镜像仓库（公共仓库、阿里云仓库、私有自建仓库）配置，用于推送/拉取镜像
                            如果不想推送至镜像仓库则无需配置
                        --></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>registry</span><span class="token punctuation">></span></span>192.168.10.10:5000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>registry</span><span class="token punctuation">></span></span>
                        <span class="token comment">&lt;!-- 镜像 build 相关配置 --></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
                            <span class="token comment">&lt;!-- 使用 Dockerfile 文件，默认地址是 src/main/docker --></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerFile</span><span class="token punctuation">></span></span>Dockerfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerFile</span><span class="token punctuation">></span></span>
                            <span class="token comment">&lt;!-- 或者指定地址例如：从项目根路径开始找 项目名/docker --></span>
                            <span class="token comment">&lt;!--&lt;dockerFile>${project.basedir}/docker/Dockerfile&lt;/dockerFile>--></span>
                            <span class="token comment">&lt;!--
                                配置构建镜像时所需要的资源
                                配置项说明：http://maven.fabric8.io/#build-assembly-descriptor
                            --></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">></span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">></span></span>artifact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">></span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>images</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 认证配置，用于镜像仓库认证 --></span>
                <span class="token comment">&lt;!--
                &lt;authConfig>
                    &lt;username>用户名&lt;/username>
                    &lt;password>密码&lt;/password>
                &lt;/authConfig>
                --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="阿里云容器配置" tabindex="-1"><a class="header-anchor" href="#阿里云容器配置" aria-hidden="true">#</a> 阿里云容器配置</h3>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 分层配置 --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layers</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layers</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- Docker 配置 --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>docker</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 推送至 Docker 服务器，配置远程 Docker 守护进程 url --></span>
                    <span class="token comment">&lt;!-- 选择不同的方式进行 docker 设置 http 还是 tcp--></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">></span></span>tcp://192.168.101.10:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>host</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 是否启用 TLS 校验 --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tlsVerify</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tlsVerify</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 开启 TLS 校验需要设置证书地址 --></span>
                    <span class="token comment">&lt;!--&lt;certPath>/home/user/.minikube/certs&lt;/certPath>--></span>
                    <span class="token comment">&lt;!-- 推送至指定镜像仓库（公共仓库、阿里云仓库、私有仓库等） --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>publishRegistry</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>registry.cn-chengdu.aliyuncs.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>publishRegistry</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>docker</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 镜像配置 --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 镜像名:版本号  参考阿里云容器服务 --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>registry.cn-chengdu.aliyuncs.com/moom/moom-auth:0.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 执行完 build 自动 push --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>publish</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>publish</span><span class="token punctuation">></span></span>
                    <span class="token comment">&lt;!-- 拉取镜像的策略，可选的值：ALWAYS, NEVER, IF_NOT_PRESENT --></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pullPolicy</span><span class="token punctuation">></span></span>IF_NOT_PRESENT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pullPolicy</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>执行以下命令进行镜像构建和推送：</p>
<blockquote>
<p>或者点击Idea 中 spring-boot：build-images</p>
</blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mvn spring-boot:build-image -Dmaven.test.skip=true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="jib-maven-plugin" tabindex="-1"><a class="header-anchor" href="#jib-maven-plugin" aria-hidden="true">#</a> jib-maven-plugin</h1>
<h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2>
<p>Jib 是 Google 开发的可以直接构建 Java 应用程序的 Docker 和 OCI 镜像的类库，以 Maven 和 Gradle 插件形式提供。</p>
<p>通过 Jib，Java 开发者可以使用他们熟悉的 Java 工具来构建容器。Jib 是一个快速而简单的容器镜像构建工具，它负责处理将应用程序打包到容器镜像中所需的所有步骤。它不需要你编写 Dockerfile 或安装 Docker，而且可以直接集成到 Maven 和 Gradle 中 —— 只需将插件添加到构建中，就可以立即将 Java 应用程序容器化。</p>
<p>Spring Boot 项目添加 jib-maven-plugin 插件。添加相关依赖。</p>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.cloud.tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jib-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="pom文件-1" tabindex="-1"><a class="header-anchor" href="#pom文件-1" aria-hidden="true">#</a> pom文件</h2>
<blockquote>
<p>Jib 可以快速将 Java 应用程序构建为 Docker 镜像推送至指定远程仓库：<br />DockerHub 官方公共仓库（DockerHub 官方公共仓库国内访问速度堪忧，不推荐）<br />阿里云镜像仓库（需要在阿里云登录账号自行创建仓库）<br />自建私有镜像仓库（本文演示方案）私有镜像仓库搭建请参考：Docker 私有镜像仓库的搭建及认证</p>
</blockquote>
<h3 id="私有仓库配置" tabindex="-1"><a class="header-anchor" href="#私有仓库配置" aria-hidden="true">#</a> 私有仓库配置</h3>
<p>完整配置如下：</p>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.cloud.tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jib-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 拉取所需的基础镜像 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 默认从官方公共仓库拉取镜像，速度较慢 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>openjdk:alpine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 从指定仓库拉取镜像提速（需提前将镜像 push 至仓库） --></span>                    <span class="token comment">&lt;!--&lt;image>192.168.10.10:5000/openjdk:alpine&lt;/image>--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- push 到哪个镜像仓库（公共仓库、阿里云仓库、私有自建仓库等） --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 使用 DockerHub 的官方公共仓库：仓库地址/用户名/镜像名 --></span>                    <span class="token comment">&lt;!--&lt;image>registry.hub.docker.com/mrhelloworld/${project.name}&lt;/image>--></span>                    <span class="token comment">&lt;!-- 使用自建的私有仓库：仓库地址/镜像名 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>192.168.10.10:5000/${project.artifactId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 镜像版本号 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tags</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tag</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tag</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tags</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 连接仓库的账号密码 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>auth</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>auth</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 使 jib 插件支持 http 协议连接镜像仓库(安全起见，默认是关闭的) --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allowInsecureRegistries</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>allowInsecureRegistries</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>container</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 启动类 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">></span></span>org.example.SpringBootDockerApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>container</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="阿里云容器配置-1" tabindex="-1"><a class="header-anchor" href="#阿里云容器配置-1" aria-hidden="true">#</a> 阿里云容器配置</h3>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.cloud.tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jib-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 拉取所需的基础镜像 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 默认从官方公共仓库拉取镜像，速度较慢 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>openjdk:8u212-jre<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 从指定仓库拉取镜像提速（需提前将镜像 push 至仓库） --></span>                    <span class="token comment">&lt;!--&lt;image>192.168.10.10:5000/openjdk:alpine&lt;/image>--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- push 到哪个镜像仓库（公共仓库、阿里云仓库、私有自建仓库等） --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 使用 DockerHub 的官方公共仓库：仓库地址/用户名/镜像名 --></span>                    <span class="token comment">&lt;!--&lt;image>registry.hub.docker.com/mrhelloworld/${project.name}&lt;/image>--></span>                    <span class="token comment">&lt;!-- 使用自建的私有仓库：仓库地址/镜像名 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>registry.cn-chengdu.aliyuncs.com/moom/moom-auth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 镜像版本号 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tags</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tag</span><span class="token punctuation">></span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tag</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tags</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 连接仓库的账号密码 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>auth</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>auth</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 使 jib 插件支持 http 协议连接镜像仓库(安全起见，默认是关闭的) --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allowInsecureRegistries</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>allowInsecureRegistries</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>container</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 启动类 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">></span></span>org.example.logging.LoggingApplication8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>container</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="docker-maven-plugin" tabindex="-1"><a class="header-anchor" href="#docker-maven-plugin" aria-hidden="true">#</a> docker-maven-plugin</h1>
<p>使用这种方式就需要我们自己维护 Dockerfile 了，这也是之前传统的构建方式，分为两个版本：</p>
<p>fabric8：开源的集成开发平台，为基于 Kubernetes、Docker 和 Jenkins 的微服务提供持续发布<br />spotify：Spotify（声田）一个正版流媒体音乐服务平台内部团队开发的插件</p>
<h2 id="fabric8" tabindex="-1"><a class="header-anchor" href="#fabric8" aria-hidden="true">#</a> fabric8</h2>
<h3 id="pom文件-2" tabindex="-1"><a class="header-anchor" href="#pom文件-2" aria-hidden="true">#</a> pom文件</h3>
<h4 id="私有仓库配置-1" tabindex="-1"><a class="header-anchor" href="#私有仓库配置-1" aria-hidden="true">#</a> 私有仓库配置</h4>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- spring-boot-maven-plugin --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- fabric8 的 docker-maven-plugin --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.fabric8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>docker-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.34.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 全局配置 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 配置远程 Docker 守护进程 url --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerHost</span><span class="token punctuation">></span></span>http://192.168.10.10:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerHost</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 镜像相关配置，支持多镜像 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>images</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 单个镜像配置 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!-- 镜像名:版本号 --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>${project.artifactId}:${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!--                            镜像仓库（公共仓库、阿里云仓库、私有自建仓库）配置，用于推送/拉取镜像                            如果不想推送至镜像仓库则无需配置                        --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>registry</span><span class="token punctuation">></span></span>192.168.10.10:5000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>registry</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!-- 镜像 build 相关配置 --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>                            <span class="token comment">&lt;!-- 使用 Dockerfile 文件，默认地址是 src/main/docker --></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerFile</span><span class="token punctuation">></span></span>Dockerfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerFile</span><span class="token punctuation">></span></span>                            <span class="token comment">&lt;!-- 或者指定地址例如：从项目根路径开始找 项目名/docker --></span>                            <span class="token comment">&lt;!--&lt;dockerFile>${project.basedir}/docker/Dockerfile&lt;/dockerFile>--></span>                            <span class="token comment">&lt;!--                                配置构建镜像时所需要的资源                                配置项说明：http://maven.fabric8.io/#build  -assembly-descriptor                            --></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">></span></span>artifact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>images</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 认证配置，用于镜像仓库认证 --></span>                <span class="token comment">&lt;!--                &lt;authConfig>                    &lt;username>用户名&lt;/username>                    &lt;password>密码&lt;/password>                &lt;/authConfig>                --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="阿里云容器配置-2" tabindex="-1"><a class="header-anchor" href="#阿里云容器配置-2" aria-hidden="true">#</a> 阿里云容器配置</h4>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- spring-boot-maven-plugin --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- fabric8 的 docker-maven-plugin --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.fabric8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>docker-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.34.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 全局配置 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 配置远程 Docker 守护进程 url --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerHost</span><span class="token punctuation">></span></span>http://192.168.10.10:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerHost</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 镜像相关配置，支持多镜像 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>images</span><span class="token punctuation">></span></span>                    <span class="token comment">&lt;!-- 单个镜像配置 --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!-- 镜像名:版本号 --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>registry.cn-chengdu.aliyuncs.com/moom/moom-auth:0.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!--                            镜像仓库（公共仓库、阿里云仓库、私有自建仓库）配置，用于推送/拉取镜像                            如果不想推送至镜像仓库则无需配置                        --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>registry</span><span class="token punctuation">></span></span>registry.cn-chengdu.aliyuncs.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>registry</span><span class="token punctuation">></span></span>                        <span class="token comment">&lt;!-- 镜像 build 相关配置 --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>                            <span class="token comment">&lt;!-- 使用 Dockerfile 文件，默认地址是 src/main/docker --></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerFile</span><span class="token punctuation">></span></span>Dockerfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerFile</span><span class="token punctuation">></span></span>                            <span class="token comment">&lt;!-- 或者指定地址例如：从项目根路径开始找 项目名/docker --></span>                            <span class="token comment">&lt;!--&lt;dockerFile>${project.basedir}/docker/Dockerfile&lt;/dockerFile>--></span>                            <span class="token comment">&lt;!--                                配置构建镜像时所需要的资源                                配置项说明：http://maven.fabric8.io/#build  -assembly-descriptor                            --></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">></span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">></span></span>artifact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>images</span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 认证配置，用于镜像仓库认证 --></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authConfig</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>authConfig</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="dockerfile-1" tabindex="-1"><a class="header-anchor" href="#dockerfile-1" aria-hidden="true">#</a> Dockerfile</h4>
<p>在项目 src/main/docker 目录下添加 Dockerfile 文件，添加以下内容。</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code># 基础镜像FROM openjdk:8u212-jre# 容器开放端口EXPOSE 8080# 将 target/docker 目录（打包以后 Dockerfile 和 jar 包在同一目录下）的 jar 包拷贝到 docker 中，并重命名为 xxx.jarADD log.jar /app.jar# 容器启动执行命令ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="打包并推送" tabindex="-1"><a class="header-anchor" href="#打包并推送" aria-hidden="true">#</a> 打包并推送</h4>
<p>执行以下命令进行镜像构建并推送至 Docker 服务：</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mvn clean package docker:build -Dmaven.test.skip=true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行以下命令进行镜像构建并推送至仓库（默认推送公共仓库，除非配置了阿里云仓库或者私有自建仓库）：</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mvn clean package docker:build docker:push -Dmaven.test.skip=true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="通过私有镜像仓库启动容器" tabindex="-1"><a class="header-anchor" href="#通过私有镜像仓库启动容器" aria-hidden="true">#</a> 通过私有镜像仓库启动容器</h1>
<p>docker run -di --name spring-boot-docker -p 8080:8080 192.168.10.10:5000/spring-boot-docker:1.0-SNAPSHOT<br />浏览器访问：<a href="http://192.168.10.10:8080/" target="_blank" rel="noopener noreferrer">http://192.168.10.10:8080/<ExternalLinkIcon/></a>，页面返回：Hello Spring Boot Docker!，表示一切 OK。</p>
</template>
