<!DOCTYPE html>
<html lang="en-Zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/icon/favicon.ico"><meta name="application-name" content="MoomHub"><meta name="apple-mobile-web-app-title" content="MoomHub"><title>番外 | 青衣水袖</title><meta name="description" content="记录学习信息的文档">
    <link rel="modulepreload" href="/assets/app.4a9c1875.js"><link rel="modulepreload" href="/assets/番外.html.4669ca30.js"><link rel="modulepreload" href="/assets/番外.html.9f5cb0f2.js"><link rel="prefetch" href="/assets/index.html.468fd202.js"><link rel="prefetch" href="/assets/随机数.html.e3d01a1e.js"><link rel="prefetch" href="/assets/TypeScript学习.html.6baf459a.js"><link rel="prefetch" href="/assets/Spring Boot 使用 Junit5测试.html.296e78aa.js"><link rel="prefetch" href="/assets/SpringBoot使用Log4j2日志框架.html.634eba63.js"><link rel="prefetch" href="/assets/SpringBoot多样化构建Docker.html.afab33b2.js"><link rel="prefetch" href="/assets/SpringBoot拦截器.html.84a45392.js"><link rel="prefetch" href="/assets/SpringBoot注解.html.c6e774de.js"><link rel="prefetch" href="/assets/SpringBoot项目Jar方式运行.html.f02763cf.js"><link rel="prefetch" href="/assets/helloworld.html.862da223.js"><link rel="prefetch" href="/assets/图形监控-Spring-Boot-Admin.html.ac745cbd.js"><link rel="prefetch" href="/assets/监控应用Spring-Boot-Actuator.html.a2cbd6f3.js"><link rel="prefetch" href="/assets/错误处理.html.bca399f9.js"><link rel="prefetch" href="/assets/MySql数据库相关概念.html.61316e19.js"><link rel="prefetch" href="/assets/Mysql查询优化-数据库优化.html.ddeac2f8.js"><link rel="prefetch" href="/assets/Mysql查询优化-语句优化.html.c1da6748.js"><link rel="prefetch" href="/assets/Mysql核心-索引.html.a83e5866.js"><link rel="prefetch" href="/assets/Mysql核心-视图.html.a1dbc1f1.js"><link rel="prefetch" href="/assets/Mysql项目-新零售数据库设计.html.1eb8a63b.js"><link rel="prefetch" href="/assets/Mysql项目-程序设计.html.f07fd66b.js"><link rel="prefetch" href="/assets/PerconaTookit工具.html.b175ecb8.js"><link rel="prefetch" href="/assets/mysql数据日志.html.f937338f.js"><link rel="prefetch" href="/assets/常用的Mysql命令.html.30719a11.js"><link rel="prefetch" href="/assets/数据库的备份和恢复.html.f4b612cc.js"><link rel="prefetch" href="/assets/MyCat学习.html.5fd1cd14.js"><link rel="prefetch" href="/assets/PXC集群主机安装.html.37e2d4fb.js"><link rel="prefetch" href="/assets/双主高可用实现负载均衡.html.17b55feb.js"><link rel="prefetch" href="/assets/安装Percona数据库.html.c588eae9.js"><link rel="prefetch" href="/assets/Java环境变量配置.html.d4a27ac2.js"><link rel="prefetch" href="/assets/Lambda表达式.html.dba2184e.js"><link rel="prefetch" href="/assets/垃圾回收GC.html.99b5409e.js"><link rel="prefetch" href="/assets/8-17新特性API.html.b23d9a9b.js"><link rel="prefetch" href="/assets/Java10新特性.html.97eb01e2.js"><link rel="prefetch" href="/assets/Java8新特性-Optional.html.37625146.js"><link rel="prefetch" href="/assets/Java8新特性-Stream流式编程.html.00d4be70.js"><link rel="prefetch" href="/assets/Java8新特性-时间类.html.2f925532.js"><link rel="prefetch" href="/assets/Java9新特性.html.bf8818e4.js"><link rel="prefetch" href="/assets/Java并发编程-AQS并发容器同步组件.html.51db2c96.js"><link rel="prefetch" href="/assets/Java线程池.html.ba5e7be1.js"><link rel="prefetch" href="/assets/实现线程的几种方式.html.fe2d808c.js"><link rel="prefetch" href="/assets/指令重排.html.d9439df1.js"><link rel="prefetch" href="/assets/等待唤醒机制.html.017bdafa.js"><link rel="prefetch" href="/assets/线程基本概念.html.757469c1.js"><link rel="prefetch" href="/assets/线程安全.html.e1b26214.js"><link rel="prefetch" href="/assets/线程的生命周期.html.5614bef2.js"><link rel="prefetch" href="/assets/Docker命令说明.html.beba32c0.js"><link rel="prefetch" href="/assets/Docker安装.html.b71e702f.js"><link rel="prefetch" href="/assets/Docker安装Mysql.html.ebbbd647.js"><link rel="prefetch" href="/assets/Docker安装Nacos.html.9f6940f1.js"><link rel="prefetch" href="/assets/Docker安装Web管理平台.html.b15dedb0.js"><link rel="prefetch" href="/assets/Docker运行设置IP.html.d446c915.js"><link rel="prefetch" href="/assets/Docker部署haproxy.html.56c21947.js"><link rel="prefetch" href="/assets/Doker安装Redis.html.2bee4f08.js"><link rel="prefetch" href="/assets/Linux定时脚本.html.3fe35291.js"><link rel="prefetch" href="/assets/Linux问题归档.html.50567e3a.js"><link rel="prefetch" href="/assets/Ubuntu设置国内镜像软件源.html.936fd155.js"><link rel="prefetch" href="/assets/Ubuntu设置远程登陆.html.1a5ecc31.js"><link rel="prefetch" href="/assets/PigGo_图床.html.ff155a0c.js"><link rel="prefetch" href="/assets/WSL2使用文档.html.957f3fb4.js"><link rel="prefetch" href="/assets/Windows使用WSL2.html.6d188cdf.js"><link rel="prefetch" href="/assets/Hystrixs-断路由使用.html.32554b19.js"><link rel="prefetch" href="/assets/Spring-Gateway配置说明.html.317c443f.js"><link rel="prefetch" href="/assets/Loadbalancer负载均衡.html.4d817f71.js"><link rel="prefetch" href="/assets/Ribbon负载均衡服务.html.edf330d3.js"><link rel="prefetch" href="/assets/服务调用OpenFeign.html.2c46cec0.js"><link rel="prefetch" href="/assets/Seata分布式事务.html.481e8b4b.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动-消费异常处理机制.html.786b5aba.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动消息过滤的三种方式.html.02cd38df.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动配置.html.8238b711.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现事务消息(三).html.8de1dfbb.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现广播和顺序消息(一).html.c980ee80.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现延时消息(二).html.1b9c9767.js"><link rel="prefetch" href="/assets/Sleuth和Zipkin.html.a2f0b365.js"><link rel="prefetch" href="/assets/DDL数据库定义语言.html.e7c3eb9e.js"><link rel="prefetch" href="/assets/DML数据处理之增删改.html.47561dd6.js"><link rel="prefetch" href="/assets/SQL练习-01.html.3b5af471.js"><link rel="prefetch" href="/assets/分组函数.html.8473766a.js"><link rel="prefetch" href="/assets/分组查询.html.4dd2e6ab.js"><link rel="prefetch" href="/assets/分页查询.html.d1a872b9.js"><link rel="prefetch" href="/assets/单行函数.html.49d51dd7.js"><link rel="prefetch" href="/assets/基本查询.html.4815160a.js"><link rel="prefetch" href="/assets/排序查询.html.2db265d0.js"><link rel="prefetch" href="/assets/数据事务.html.c916bb27.js"><link rel="prefetch" href="/assets/数据库和SQL概述.html.0f673c1a.js"><link rel="prefetch" href="/assets/条件查询.html.9cdf8def.js"><link rel="prefetch" href="/assets/联合查询.html.9917791e.js"><link rel="prefetch" href="/assets/连接查询.html.b22a4de2.js"><link rel="prefetch" href="/assets/404.html.01fa9517.js"><link rel="prefetch" href="/assets/index.html.5836dbf6.js"><link rel="prefetch" href="/assets/随机数.html.3a815f5c.js"><link rel="prefetch" href="/assets/TypeScript学习.html.adbd8f1d.js"><link rel="prefetch" href="/assets/Spring Boot 使用 Junit5测试.html.e12cb97d.js"><link rel="prefetch" href="/assets/SpringBoot使用Log4j2日志框架.html.ec9f8897.js"><link rel="prefetch" href="/assets/SpringBoot多样化构建Docker.html.758e3dcb.js"><link rel="prefetch" href="/assets/SpringBoot拦截器.html.321a2949.js"><link rel="prefetch" href="/assets/SpringBoot注解.html.8ca4a871.js"><link rel="prefetch" href="/assets/SpringBoot项目Jar方式运行.html.ab0a01da.js"><link rel="prefetch" href="/assets/helloworld.html.44762b40.js"><link rel="prefetch" href="/assets/图形监控-Spring-Boot-Admin.html.8d4ca6ca.js"><link rel="prefetch" href="/assets/监控应用Spring-Boot-Actuator.html.5a40f374.js"><link rel="prefetch" href="/assets/错误处理.html.ab07afd8.js"><link rel="prefetch" href="/assets/MySql数据库相关概念.html.3b9e3bf3.js"><link rel="prefetch" href="/assets/Mysql查询优化-数据库优化.html.a6bbc83b.js"><link rel="prefetch" href="/assets/Mysql查询优化-语句优化.html.7d093d44.js"><link rel="prefetch" href="/assets/Mysql核心-索引.html.577b06a8.js"><link rel="prefetch" href="/assets/Mysql核心-视图.html.ec7b22f4.js"><link rel="prefetch" href="/assets/Mysql项目-新零售数据库设计.html.0307ce1d.js"><link rel="prefetch" href="/assets/Mysql项目-程序设计.html.d9827e01.js"><link rel="prefetch" href="/assets/PerconaTookit工具.html.1d426870.js"><link rel="prefetch" href="/assets/mysql数据日志.html.d62edff2.js"><link rel="prefetch" href="/assets/常用的Mysql命令.html.573bd433.js"><link rel="prefetch" href="/assets/数据库的备份和恢复.html.7574270e.js"><link rel="prefetch" href="/assets/MyCat学习.html.a4f01480.js"><link rel="prefetch" href="/assets/PXC集群主机安装.html.04a9ffe0.js"><link rel="prefetch" href="/assets/双主高可用实现负载均衡.html.e603c3de.js"><link rel="prefetch" href="/assets/安装Percona数据库.html.7d1d9ea9.js"><link rel="prefetch" href="/assets/Java环境变量配置.html.94200dd4.js"><link rel="prefetch" href="/assets/Lambda表达式.html.e86ff6e4.js"><link rel="prefetch" href="/assets/垃圾回收GC.html.39db3df8.js"><link rel="prefetch" href="/assets/8-17新特性API.html.11150ca2.js"><link rel="prefetch" href="/assets/Java10新特性.html.5da7d147.js"><link rel="prefetch" href="/assets/Java8新特性-Optional.html.ea2715a6.js"><link rel="prefetch" href="/assets/Java8新特性-Stream流式编程.html.ab89bcd5.js"><link rel="prefetch" href="/assets/Java8新特性-时间类.html.a0f829e5.js"><link rel="prefetch" href="/assets/Java9新特性.html.bcbd2596.js"><link rel="prefetch" href="/assets/Java并发编程-AQS并发容器同步组件.html.28d60a64.js"><link rel="prefetch" href="/assets/Java线程池.html.9a838964.js"><link rel="prefetch" href="/assets/实现线程的几种方式.html.6d97db33.js"><link rel="prefetch" href="/assets/指令重排.html.c0f655d4.js"><link rel="prefetch" href="/assets/等待唤醒机制.html.32bee595.js"><link rel="prefetch" href="/assets/线程基本概念.html.285fe513.js"><link rel="prefetch" href="/assets/线程安全.html.9e70119f.js"><link rel="prefetch" href="/assets/线程的生命周期.html.54b9a36a.js"><link rel="prefetch" href="/assets/Docker命令说明.html.10a35eb1.js"><link rel="prefetch" href="/assets/Docker安装.html.9b72fbaf.js"><link rel="prefetch" href="/assets/Docker安装Mysql.html.8e9dcc3d.js"><link rel="prefetch" href="/assets/Docker安装Nacos.html.0c7066c8.js"><link rel="prefetch" href="/assets/Docker安装Web管理平台.html.16b66a1e.js"><link rel="prefetch" href="/assets/Docker运行设置IP.html.e399fc36.js"><link rel="prefetch" href="/assets/Docker部署haproxy.html.30c338c9.js"><link rel="prefetch" href="/assets/Doker安装Redis.html.e01811d9.js"><link rel="prefetch" href="/assets/Linux定时脚本.html.0773130e.js"><link rel="prefetch" href="/assets/Linux问题归档.html.836078cf.js"><link rel="prefetch" href="/assets/Ubuntu设置国内镜像软件源.html.36089e7f.js"><link rel="prefetch" href="/assets/Ubuntu设置远程登陆.html.989392fb.js"><link rel="prefetch" href="/assets/PigGo_图床.html.7c94cd32.js"><link rel="prefetch" href="/assets/WSL2使用文档.html.17f7d9b8.js"><link rel="prefetch" href="/assets/Windows使用WSL2.html.6a552282.js"><link rel="prefetch" href="/assets/Hystrixs-断路由使用.html.e43be0b5.js"><link rel="prefetch" href="/assets/Spring-Gateway配置说明.html.77da2095.js"><link rel="prefetch" href="/assets/Loadbalancer负载均衡.html.3a0a3ad7.js"><link rel="prefetch" href="/assets/Ribbon负载均衡服务.html.7d2b1290.js"><link rel="prefetch" href="/assets/服务调用OpenFeign.html.937ef2d2.js"><link rel="prefetch" href="/assets/Seata分布式事务.html.c4acbc31.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动-消费异常处理机制.html.6aa10f8f.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动消息过滤的三种方式.html.419c75d5.js"><link rel="prefetch" href="/assets/Spring-Cloud-Stream消息驱动配置.html.82681e2a.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现事务消息(三).html.9f32a439.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现广播和顺序消息(一).html.cd050fc9.js"><link rel="prefetch" href="/assets/Stream整合Rocketmq实现延时消息(二).html.bf43339a.js"><link rel="prefetch" href="/assets/Sleuth和Zipkin.html.1847a36b.js"><link rel="prefetch" href="/assets/DDL数据库定义语言.html.a1b0f725.js"><link rel="prefetch" href="/assets/DML数据处理之增删改.html.4cdfca73.js"><link rel="prefetch" href="/assets/SQL练习-01.html.77d68c39.js"><link rel="prefetch" href="/assets/分组函数.html.cb093a68.js"><link rel="prefetch" href="/assets/分组查询.html.d18eada3.js"><link rel="prefetch" href="/assets/分页查询.html.f56764e6.js"><link rel="prefetch" href="/assets/单行函数.html.deb9ae79.js"><link rel="prefetch" href="/assets/基本查询.html.8310c45c.js"><link rel="prefetch" href="/assets/排序查询.html.d998eca8.js"><link rel="prefetch" href="/assets/数据事务.html.ab27f45c.js"><link rel="prefetch" href="/assets/数据库和SQL概述.html.5ae239f0.js"><link rel="prefetch" href="/assets/条件查询.html.f14c61c1.js"><link rel="prefetch" href="/assets/联合查询.html.d8a5248d.js"><link rel="prefetch" href="/assets/连接查询.html.a0959fc2.js"><link rel="prefetch" href="/assets/404.html.9b9bf036.js"><link rel="prefetch" href="/assets/404.1cfa2fc0.js"><link rel="prefetch" href="/assets/Layout.ce6856c3.js">
    <link rel="stylesheet" href="/assets/style.811e635c.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/png/logo.png" alt="青衣水袖"><span class="site-name can-hide">青衣水袖</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java/newApi/8-17新特性API.html" class="" aria-label="Java 版本特性"><!--[--><!--]--> Java 版本特性 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/base/Java环境变量配置.html" class="" aria-label="Java 基础"><!--[--><!--]--> Java 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/thread/线程基本概念.html" class="" aria-label="多线程"><!--[--><!--]--> 多线程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端文档"><span class="title">后端文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端文档"><span class="title">后端文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring 系列</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/springboot/helloworld.html" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/springcloud/gateway/Spring-Gateway配置说明.html" class="" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/springcloud/gateway/Spring-Gateway配置说明.html" class="" aria-label="Spring Cloud Alibaba"><!--[--><!--]--> Spring Cloud Alibaba <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/database/mysql/base/数据库和SQL概述.html" class="" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/database/pxc/安装Percona数据库.html" class="" aria-label="Percona Xtradb Cluster"><!--[--><!--]--> Percona Xtradb Cluster <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/linux/Ubuntu设置国内镜像软件源.html" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker/Docker安装.html" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/mix/PigGo+图床.html" class="" aria-label="杂项"><!--[--><!--]--> 杂项 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/web/TypeScript学习.html" class="" aria-label="TypeScript学习"><!--[--><!--]--> TypeScript学习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/moomhub/Notes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java/newApi/8-17新特性API.html" class="" aria-label="Java 版本特性"><!--[--><!--]--> Java 版本特性 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/base/Java环境变量配置.html" class="" aria-label="Java 基础"><!--[--><!--]--> Java 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/thread/线程基本概念.html" class="" aria-label="多线程"><!--[--><!--]--> 多线程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端文档"><span class="title">后端文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端文档"><span class="title">后端文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring 系列</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/springboot/helloworld.html" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/springcloud/gateway/Spring-Gateway配置说明.html" class="" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/springcloud/gateway/Spring-Gateway配置说明.html" class="" aria-label="Spring Cloud Alibaba"><!--[--><!--]--> Spring Cloud Alibaba <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/database/mysql/base/数据库和SQL概述.html" class="" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/database/pxc/安装Percona数据库.html" class="" aria-label="Percona Xtradb Cluster"><!--[--><!--]--> Percona Xtradb Cluster <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/linux/Ubuntu设置国内镜像软件源.html" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker/Docker安装.html" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/mix/PigGo+图床.html" class="" aria-label="杂项"><!--[--><!--]--> 杂项 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/web/TypeScript学习.html" class="" aria-label="TypeScript学习"><!--[--><!--]--> TypeScript学习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/moomhub/Notes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Percona Xtradb Cluster <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/database/pxc/%E5%AE%89%E8%A3%85Percona%E6%95%B0%E6%8D%AE%E5%BA%93.html" class="sidebar-item" aria-label="安装Percona数据库"><!--[--><!--]--> 安装Percona数据库 <!--[--><!--]--></a><!----></li><li><a href="/database/pxc/PXC%E9%9B%86%E7%BE%A4%E4%B8%BB%E6%9C%BA%E5%AE%89%E8%A3%85.html" class="sidebar-item" aria-label="PXC 集群安装"><!--[--><!--]--> PXC 集群安装 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">MyCat 数据库中间件 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/database/pxc/MyCat%E5%AD%A6%E4%B9%A0.html" class="sidebar-item" aria-label="MyCat 学习"><!--[--><!--]--> MyCat 学习 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">高可用集群 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/database/pxc/%E5%8F%8C%E4%B8%BB%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html" class="sidebar-item" aria-label="/database/pxc/双主高可用实现负载均衡.md"><!--[--><!--]--> /database/pxc/双主高可用实现负载均衡.md <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">番外 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="番外"><!--[--><!--]--> 番外 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#一、mysql-架构" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、Mysql 架构"><!--[--><!--]--> 一、Mysql 架构 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#_1-mysql-分布式-proxy-扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.MySQL+分布式 Proxy 扩展"><!--[--><!--]--> 1.MySQL+分布式 Proxy 扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#_2-数据归档-冷热数据分离" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.数据归档，冷热数据分离"><!--[--><!--]--> 2.数据归档，冷热数据分离 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#_3-mysql-缓存-redis-高并发架构" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.MySQL+缓存(Redis）高并发架构"><!--[--><!--]--> 3.MySQL+缓存(Redis）高并发架构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#_4-mysql-小文件系统" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.MySQL+小文件系统"><!--[--><!--]--> 4.MySQL+小文件系统 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#_5-mysql-inforbright-统计分析架构" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.MySQL+Inforbright 统计分析架构"><!--[--><!--]--> 5.MySQL+Inforbright 统计分析架构 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#大数据-mysql-分页查询加速" class="router-link-active router-link-exact-active sidebar-item" aria-label="大数据 MySql 分页查询加速"><!--[--><!--]--> 大数据 MySql 分页查询加速 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#大数据中重复写入的案例" class="router-link-active router-link-exact-active sidebar-item" aria-label="大数据中重复写入的案例"><!--[--><!--]--> 大数据中重复写入的案例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#数据库高并发访问优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据库高并发访问优化"><!--[--><!--]--> 数据库高并发访问优化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#mysql-数据库设计-字段设计原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="MySQL 数据库设计:字段设计原则"><!--[--><!--]--> MySQL 数据库设计:字段设计原则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#mysql-数据库设计-索引设计原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="MySQL 数据库设计:索引设计原则"><!--[--><!--]--> MySQL 数据库设计:索引设计原则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#mysql-数据库设计-sql-设计原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="MySQL 数据库设计: SQL 设计原则"><!--[--><!--]--> MySQL 数据库设计: SQL 设计原则 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#大数据归档-冷热数据归档" class="router-link-active router-link-exact-active sidebar-item" aria-label="大数据归档（冷热数据归档）"><!--[--><!--]--> 大数据归档（冷热数据归档） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#执行数据归档" class="router-link-active router-link-exact-active sidebar-item" aria-label="执行数据归档"><!--[--><!--]--> 执行数据归档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#数据库备份" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据库备份"><!--[--><!--]--> 数据库备份 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#数据库表碎片整理" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据库表碎片整理"><!--[--><!--]--> 数据库表碎片整理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#数据库联机冷备份" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据库联机冷备份"><!--[--><!--]--> 数据库联机冷备份 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/database/pxc/%E7%95%AA%E5%A4%96.html#数据库联机热备份" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据库联机热备份"><!--[--><!--]--> 数据库联机热备份 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="番外" tabindex="-1"><a class="header-anchor" href="#番外" aria-hidden="true">#</a> 番外</h1><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/XGAH5WxBs6bYFc7.png" alt="image-20200928115625927"></p><h2 id="一、mysql-架构" tabindex="-1"><a class="header-anchor" href="#一、mysql-架构" aria-hidden="true">#</a> 一、Mysql 架构</h2><p>一共有 5 种</p><h3 id="_1-mysql-分布式-proxy-扩展" tabindex="-1"><a class="header-anchor" href="#_1-mysql-分布式-proxy-扩展" aria-hidden="true">#</a> 1.MySQL+分布式 Proxy 扩展</h3><p>PXC +Proxy 组成相关的配置</p><p>构建索引，使用索引进行优化</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/yj6tYMeNB7sxR4u.png" alt="image-20200928110416123"></p><p>数据拆分的好处</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/49aRUHn3oIdivBc.png" alt="image-20200928115116096"></p><h3 id="_2-数据归档-冷热数据分离" tabindex="-1"><a class="header-anchor" href="#_2-数据归档-冷热数据分离" aria-hidden="true">#</a> 2.数据归档，冷热数据分离</h3><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/kWDZRhMNqwoHOe3.png" alt="image-20200927173016292"></p><h3 id="_3-mysql-缓存-redis-高并发架构" tabindex="-1"><a class="header-anchor" href="#_3-mysql-缓存-redis-高并发架构" aria-hidden="true">#</a> 3.MySQL+缓存(Redis）高并发架构</h3><h3 id="_4-mysql-小文件系统" tabindex="-1"><a class="header-anchor" href="#_4-mysql-小文件系统" aria-hidden="true">#</a> 4.MySQL+小文件系统</h3><h3 id="_5-mysql-inforbright-统计分析架构" tabindex="-1"><a class="header-anchor" href="#_5-mysql-inforbright-统计分析架构" aria-hidden="true">#</a> 5.MySQL+Inforbright 统计分析架构</h3><p>慢 非常耗时！</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/J48Ca9LnkuQMvPZ.png" alt="image-20200928124715036"></p><p>海量数据导入 10W+</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/HvRfuU91Ygp5284.png" alt="image-20200928125032913"></p><p>修改 PXC 配置文件 [mysqld] innodb_flush_log_at_trx_commit= o innodb_flush_method = O_DIRECT innodb_buffer_pool_size = 200M</p><h2 id="大数据-mysql-分页查询加速" tabindex="-1"><a class="header-anchor" href="#大数据-mysql-分页查询加速" aria-hidden="true">#</a> 大数据 MySql 分页查询加速</h2><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>#原本的Mysql 分页查询
select * from test limit 5000000,100;
# 优化一
select * from test where id&gt;=50000000 limit 100;
# 优化三
select * from test where id&gt;=50000000 and id&lt;=50000000+100;
#不连贯的表怎么优化
#1逻辑删除
#2使用如下方法
SELECT tid, tname FROM t test t JOIN (SELECT id FROM t test LIMIT 5000000, 100) tmp ON tid =tmp.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="大数据中重复写入的案例" tabindex="-1"><a class="header-anchor" href="#大数据中重复写入的案例" aria-hidden="true">#</a> 大数据中重复写入的案例</h2><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/p6lFqmKQASehgy2.png" alt="image-20201012143043634"></p><p>网络重复请求导致重复发卡导致损失</p><p>解决方法</p><p>1、前端拦截</p><p>2、使用 redis 计数器 （redis 加锁）死锁？</p><p>3、令牌拦截</p><h2 id="数据库高并发访问优化" tabindex="-1"><a class="header-anchor" href="#数据库高并发访问优化" aria-hidden="true">#</a> 数据库高并发访问优化</h2><p>不在数据库做运算</p><p>CPUi 计算务必须移至业务层</p><p>控制字段数量(少而精,注意拆分)</p><p>平衡范式与冗余(效率优先,可以牺牲范式)</p><p>拒绝大 sql 语句、拒绝大事物、拒绝大批量</p><h3 id="mysql-数据库设计-字段设计原则" tabindex="-1"><a class="header-anchor" href="#mysql-数据库设计-字段设计原则" aria-hidden="true">#</a> MySQL 数据库设计:字段设计原则</h3><p>用恰当的数据类型·字符转化为数字(节约空间,提高查询性能)</p><p>避免使用 NULL 字段(NULL 很难查询优化、索引需要额外空间,而且复合索引无效)·</p><p>少用 text 类型(尽量使用 varchar 代替 text 字段);</p><h3 id="mysql-数据库设计-索引设计原则" tabindex="-1"><a class="header-anchor" href="#mysql-数据库设计-索引设计原则" aria-hidden="true">#</a> MySQL 数据库设计:索引设计原则</h3><p>合理使用索引 (改善查询,减慢更新)</p><p>长字符串字段必须建前缀索引</p><p>不在索引做列运算</p><p>不用外键(使用逻辑外键)</p><h3 id="mysql-数据库设计-sql-设计原则" tabindex="-1"><a class="header-anchor" href="#mysql-数据库设计-sql-设计原则" aria-hidden="true">#</a> MySQL 数据库设计: SQL 设计原则</h3><p>sQL 语句尽可能简单</p><p>简单的事务避免使用触发器和存储过程</p><p>OR 改写成 IN</p><p>OR 写成 UNION</p><p>MYSQL+REDIS</p><p>Canal</p><h2 id="大数据归档-冷热数据归档" tabindex="-1"><a class="header-anchor" href="#大数据归档-冷热数据归档" aria-hidden="true">#</a> 大数据归档（冷热数据归档）</h2><p>数据归档‘按月、年进行归档</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/TU8oSOFVDXlgKb3.png" alt="image-20201013100928540"></p><p>不建议 InnoDB 使用 TokuDB</p><p>TokuDB 引擎的优点</p><ol><li>高压缩比</li><li>高写入性能</li><li>在线创建索引和字段</li><li>支持事物</li><li>支持主从同步</li></ol><p>安装 TokuDB 引擎</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/NQuClYV9an8gm5h.png" alt="image-20201013134254745"></p><p>大数据归档工具</p><pre><code>Percona工具包
pt-online-schema-change
pt-query-advisor
pt-archiver
....
Percona-Toolkit
</code></pre><p>pt-archiver 的用途</p><p>导出线上数据,到线下数据作处理清理过期数据,并把数据归档到本地归档表中,或者远端归档服务器</p><h2 id="执行数据归档" tabindex="-1"><a class="header-anchor" href="#执行数据归档" aria-hidden="true">#</a> 执行数据归档</h2><ul><li><p>安装 pt-archiver</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> percona-toolkit
pt-archiver --version
pt-archiver --help
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行数据归档</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pt-archiver --source <span class="token assign-left variable">h</span><span class="token operator">=</span><span class="token number">192.168</span>.99.102,P<span class="token operator">=</span><span class="token number">8066</span>,u<span class="token operator">=</span>admin,p<span class="token operator">=</span>Abc_123456,D<span class="token operator">=</span>test,t<span class="token operator">=</span>t_purchase --dest <span class="token assign-left variable">h</span><span class="token operator">=</span><span class="token number">192.168</span>.99.102,P<span class="token operator">=</span><span class="token number">3306</span>,u<span class="token operator">=</span>admin,p<span class="token operator">=</span>Abc_123456,D<span class="token operator">=</span>test,t<span class="token operator">=</span>t_purchase --no-check-charset --where <span class="token string">&#39;purchase_date&lt;&quot;2018-09&quot;&#39;</span> --progress <span class="token number">5000</span> --bulk-delete --bulk-insert --limit<span class="token operator">=</span><span class="token number">10000</span> --statistics
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>逻辑库文件解析</p><p>opt 用来描述字符集和字符集的排序</p><p>frm 数据表的定义数据结构信息文件</p><p>MyISAM</p><p>IBD 可以编译文件</p><h2 id="数据库备份" tabindex="-1"><a class="header-anchor" href="#数据库备份" aria-hidden="true">#</a> 数据库备份</h2><h3 id="数据库表碎片整理" tabindex="-1"><a class="header-anchor" href="#数据库表碎片整理" aria-hidden="true">#</a> 数据库表碎片整理</h3><p>alter table 表名 engine=InnoDB 使用之前要把 mysql 配置文件中的 conf 给注释掉</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>#log_bin
#log_slave_updates
相关的文件对应的内容
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据库联机冷备份" tabindex="-1"><a class="header-anchor" href="#数据库联机冷备份" aria-hidden="true">#</a> 数据库联机冷备份</h3><p>通过脚本批量表碎片整理</p><p>然后在备份表数据 备份表分区</p><h3 id="数据库联机热备份" tabindex="-1"><a class="header-anchor" href="#数据库联机热备份" aria-hidden="true">#</a> 数据库联机热备份</h3><p>热备份是在数据库运行的状态下备份数据,也是难度最大的备份</p><p>PXC 常见的热备份有 LVM 和 XtraBackup 两种方案</p><p>XtraBackup 优势</p><p>◆XtraBackup 备份过程加读锁，数据可读，但是不可写</p><p>◆XtraBackup 备份过程不会打断正在执行的事务</p><p>全量备份和增量备份</p><p>◆ 全量备份是备份全部数据。备份过程时间长，占用空间大</p><p>增量备份是只备份变化的那部分数据。备份时间短，占用空间小</p><p>XtraBackup 备份原理</p><p>XtraBackup 是一种物理备份工具，通过协议连接到 MySQL 服务端，然后读取并复制底层的文件，完成物理备份</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/3EQh78BcpAR2eKx.png" alt="image-20201014114458401"></p><p>XtraBackup 安装</p><p>https://www.percona.com/downloads/Percona-XtraBackup-LATEST/</p><p>XtraBackup 命令种类</p><table><thead><tr><th>序号</th><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>xbcrypt</td><td>用于加密或解密备份的数据</td></tr><tr><td>2</td><td>xbstream</td><td>用于压缩或者解压缩 xbstream 文件</td></tr><tr><td>3</td><td>xtrabackup</td><td>备份 lnnoDB 数据表（只备份数据文件，不备份结构文件）</td></tr><tr><td>4</td><td>innobackupex</td><td>是上面三种命令的 perl 脚本封装</td></tr></tbody></table><p>Xtrabackup 全量热备份</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/etc/my.cnf --host<span class="token operator">=</span><span class="token number">192.168</span>.99.151 --user<span class="token operator">=</span>admin --password<span class="token operator">=</span>Abc_123456 --port<span class="token operator">=</span><span class="token number">3306</span> /home/backup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>备份 docker 里面的数据库文件时失败时---&gt; 将你容器中的 mysql 端口映射一个宿主机的端口出来，使用外部的 ip 端口</p><p>流式备份</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/etc/my.cnf --host<span class="token operator">=</span><span class="token number">192.168</span>.99.151 --user<span class="token operator">=</span>admin --password<span class="token operator">=</span>Abc_123456 --port<span class="token operator">=</span><span class="token number">3306</span>  --no-timestamp --stream<span class="token operator">=</span>xbstream -<span class="token operator">&gt;</span> /home/backup.xbstream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>加密备份</p><p>使用加密备份</p><table><thead><tr><th>序号</th><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>encrypt</td><td>用于加密的算法：AES128、AES192、AES256</td></tr><tr><td>2</td><td>encrypt-threads</td><td>执行加密的线程数</td></tr><tr><td>3</td><td>encrypt-chunk-size</td><td>加密线程的缓存大小</td></tr><tr><td>4</td><td>encrypt-key</td><td>密钥字符(24 个字符)</td></tr><tr><td>5</td><td>encryption-key-file</td><td>密钥文件</td></tr></tbody></table><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/etc/my.cnf --host<span class="token operator">=</span><span class="token number">192.168</span>.99.151 --user<span class="token operator">=</span>admin --password<span class="token operator">=</span>Abc_123456 --port<span class="token operator">=</span><span class="token number">3306</span> --encrypt<span class="token operator">=</span>AES256 --encrypt-threads<span class="token operator">=</span><span class="token number">10</span> --encrypt-chunk-size <span class="token number">512</span>  --no-timestamp --stream<span class="token operator">=</span>xbstream -<span class="token operator">&gt;</span> /home/backup.xbstream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>脚本脚本进行热备份</p><p>Linux Cron 表达式</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/M2GQkEZweNdAhyl.png" alt="image-20201014163119898"></p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/Law9xHYy25vEVWp.png" alt="image-20201014163143017"></p><p>Corntab 介绍</p><p>◆Crontab 命令被用来提交和管理用户的需要周期性执行的任务</p><p>◆Linux 会自动启动 Crontab 进程，Crontab 会每分钟定期检查是否有要执行的任务，如果有，则自动执行</p><p>Crontab 管理命令</p><p>$service crontab start</p><p>$ service crontab stop</p><p>$service crontab restart</p><p>Crontab 任务分类</p><p>◆Linux 系统中任务调度分为系统调度和用户调度</p><p>◆ 系统调度：/etc/crontab</p><p>◆ 用户调度：/var/spool/cron/crontab</p><pre><code>CronTab命令
$ crontab参数
-1打印用户任务列表u。
-r删除用户任务列表
-e编辑用户任务列表
</code></pre><p>编写 sh 脚本</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span><span class="token string">&quot;执行全量热备份 <span class="token variable">${time}</span>&quot;</span>
innobackupex --defaults-file<span class="token operator">=</span>/etc/my.cnf --host<span class="token operator">=</span><span class="token number">192.168</span>.99.151 --user<span class="token operator">=</span>admin --password<span class="token operator">=</span>Abc_123456 --port<span class="token operator">=</span><span class="token number">3306</span> --encrypt<span class="token operator">=</span>AES256 --encrypt-threads<span class="token operator">=</span><span class="token number">10</span> --encrypt-key<span class="token operator">=</span><span class="token number">111111111111111111111111</span> --encrypt-chunk-size <span class="token number">512</span>--stream<span class="token operator">=</span>xbstream -<span class="token operator">&gt;</span> /home/demol.xbstream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>chmod -R 777 ./backuMysql.sh</p><p>配置 Crontab</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">crontab</span> -e

<span class="token comment"># 以下为编辑状态 xxx 为定时的表达式  2&gt;&amp;1 打印错误和正确的日志</span>
xxxx /home/shell/demo1.sh <span class="token operator">&gt;</span> /home/log/demo1.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>全量冷还原</p><p>冷还原前的准备工作</p><p>◆ 关闭 MySQL，清空数据目录，包括表分区的目录</p><p>◆ 回滚没有提交的事物，同步已经提交的事务到数据文件</p><p>清除事务指令</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1、停掉MySQL
2、删除mysql数据目录
3、清理表分区（如果有的话）
4、


innobackupex --apply-log /home/backup/2018-09-12_10-1-1

执行全量冷还原
innobackupex --defaults-file=/etc/my.cnf --copy-back /home/backup/2018-09-12_10-53-51
chown -R mysql:mysql /var/lib/mysql/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>流式备份文档冷还原</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>创建临时目录
mkdir /home/temp
解压文件
xbstream -x &lt; /home/backup.xbstream -C /home/temp
解密
innobackupex --decompress --decrypt=AES256 --encrypt-key=111111111111111111111111 /home/temp
还原
innobackupex --copy-back --defaults-file=/etc/my.cnf /home/temp
设置所属用户和权限
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>增量热备份</p><p>增量热备份的注意事项</p><ol><li>无论全量热备份使用了流式压缩，还是内容加密，都必须解密解压缩成普通全量热备份</li><li>增量热备份可以使用流式压缩或者内容加密</li><li>--incremental 关键字</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/etc/my.cnf --host<span class="token operator">=</span><span class="token number">192.168</span>.99.151 --user<span class="token operator">=</span>admin --password<span class="token operator">=</span>Abc <span class="token number">123456</span> --port<span class="token operator">=</span><span class="token number">3306</span> --incremental-basedir<span class="token operator">=</span>/home/backup/2018-09- 12_21-27-50 --incremental /home/backup/increment
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>加密的</p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/B9INuKepihsYrbz.png" alt="image-20201015172304973"></p><p><img src="https://cdn.jsdelivr.net/gh/moomhub/notes_images01/images/OpjbazmZdJ1U7A6.png" alt="image-20201015171350931"></p><p>使用 Java 定时任务来进行定时增量热备份</p><p>增量冷恢复</p><p>处理事物日志</p><p>innobackupex -apply-log --redo-only /home/backup/2018- 09-1221-27-50</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/moomhub/Notes/edit/main/docs/database/pxc/番外.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 2208300539@qq.com">MoomHub</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.4a9c1875.js" defer></script>
  </body>
</html>
